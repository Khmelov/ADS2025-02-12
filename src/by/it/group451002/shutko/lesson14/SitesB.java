package by.it.group451002.shutko.lesson14;

import java.util.*;
import java.util.stream.Collectors;

// есть набор связанных через взаимные гиперссылки сайтов,
// и мы хотим разбить их на кластеры, то есть объединить связанные сайтов в кластеры
// Нужно вывести на консоль число сайтов в полученных кластерах (в порядке возрастания)
public class SitesB {

    public static void main(String[] args) {
        // Список для хранения кластеров (компонент связности) сайтов
        // Каждый Set<String> представляет один кластер связанных сайтов
        List<Set<String>> dsu = new ArrayList<>();

        // Множество для хранения всех уникальных связей (пар сайтов)
        Set<String> links = new HashSet<>();

        try (Scanner scanner = new Scanner(System.in)) {
            String line;
            // Чтение входных данных пока не встретится строка "end"
            while (!(line = scanner.nextLine()).equals("end")) {
                // Добавляем строку связи в множество всех связей
                links.add(line);

                // Разделяем строку на два сайта по символу '+'
                String[] sites = line.split("\\+");

                // Создаем новый кластер из этих двух сайтов
                // Изначально каждый кластер содержит только сайты из одной связи
                Set<String> set = new HashSet<>(Arrays.asList(sites));
                dsu.add(set); // Добавляем кластер в общий список
            }
        }

        // Алгоритм объединения кластеров
        // Внешний цикл: проходим по всем кластерам
        for (int i = 0; i < dsu.size(); i++) {
            // Внутренний цикл: проверяем текущий кластер со всеми другими
            for (Set<String> set : dsu) {
                boolean union = false; // Флаг: нужно ли объединять кластеры

                // Метка для выхода из вложенных циклов
                label:
                if (dsu.get(i) != set) { // Не проверяем кластер с самим собой
                    // Проверяем все возможные пары сайтов между двумя кластерами
                    for (String site1 : dsu.get(i)) {
                        for (String site2 : set) {
                            // Если сайты не одинаковые И между ними есть прямая связь
                            if (!site1.equals(site2) && checkLink(links, site1, site2)) {
                                union = true; // Найдена связь - нужно объединить
                                break label; // Выходим из всех вложенных циклов
                            }
                        }
                    }
                }

                // Если найдена связь между кластерами
                if (union) {
                    // Объединяем кластеры: добавляем все сайты из второго кластера в первый
                    dsu.get(i).addAll(set);
                    set.clear(); // Очищаем второй кластер (теперь он пустой)
                    i = 0; // Начинаем алгоритм заново с начала списка
                    // Это нужно, так как объединение могло создать новые возможности для объединения
                }
            }
        }

        // Удаляем все пустые кластеры (образовались после объединений)
        dsu.removeIf(Set::isEmpty);

        // Преобразуем размеры кластеров в отсортированную строку для вывода
        String output = dsu.stream()
                .map(Set::size)              // Получаем размер каждого кластера
                .sorted((n, m) -> m - n)     // Сортируем по убыванию (обратный порядок)
                .map(String::valueOf)        // Преобразуем числа в строки
                .collect(Collectors.joining(" ")) // Объединяем через пробел
                .trim();                     // Убираем возможные пробелы по краям

        System.out.println(output); // Вывод результата
    }

    // Метод для проверки существования связи между двумя сайтами
    private static boolean checkLink(Set<String> links, String site1, String site2) {
        // Проверяем наличие связи в обоих направлениях:
        // "site1+site2" или "site2+site1"
        // Связь неориентированная, поэтому проверяем оба варианта
        return links.contains(String.format("%s+%s", site1, site2)) ||
                links.contains(String.format("%s+%s", site2, site1));
    }
}